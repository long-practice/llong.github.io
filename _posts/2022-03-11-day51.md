---
title: í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ì¸ê³µì§€ëŠ¥ ë°ë¸Œì½”ìŠ¤ 51ì¼ì°¨
layout: post
post-image: https://user-images.githubusercontent.com/83870423/148743292-e6a1b86d-95ca-4f30-b96a-482104d72319.png
description: 11ì£¼ì°¨(22.2.21.(ì›”) ~ 22.2.25.(ê¸ˆ)) 
  SQL ì†Œê°œ ë° ë¬¸ë²•
  SQLì„ ì´ìš©í•œ ë°ì´í„°ë¶„ì„ ì‹¤ìŠµ
  ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ Redshift
tags:
- SQL
- SQL ì£¼ì„
- DDL
- CREATE TABLE
- DML
- SELECT
- WHERE
- IN / NOT IN
- WHERE
- LIKE / ILIKE
- GROUP BY
- ORDER BY
- CASE WHEN
- is NULL / is not NULL
- Type Casting

use_math: True
---
# 51ì¼ì°¨(ML_basics - DDL, DML)

11ì£¼ì°¨(22.2.21.(ì›”) ~ 22.2.25.(ê¸ˆ)): SQLê³¼ ë°ì´í„°ë¶„ì„
* Redshiftë¥¼ í†µí•œ SQL(DDL, DML) ì‹¤ìŠµ
* ê³ ê¸‰ ë¬¸ë²• ì†Œê°œ, ì‹¤ìŠµ
* monthly project
* Docker ì„¸íŒ…
<br>
<br>

ì¶œì²˜: í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ì¸ê³µì§€ëŠ¥ ë°ë¸Œì½”ìŠ¤ 3ê¸° ê°•ì˜

### ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì˜ˆì‹œ

#### ì›¹ì„œë¹„ìŠ¤ ì‚¬ìš©ì, ì„¸ì…˜ ì •ë³´
- ì‚¬ìš©ì ID: ì›¹ì„œë¹„ìŠ¤ì—ì„œ ë“±ë¡ëœ ì‚¬ìš©ìë§ˆë‹¤ ë¶€ì—¬í•˜ëŠ” ID
- ì„¸ì…˜ ID: ì„¸ì…˜ë§ˆë‹¤ ë¶€ì—¬ë˜ëŠ” ID<br>
  - ì„¸ì…˜: ì‚¬ìš©ìì˜ ë°©ë¬¸ì„ ë…¼ë¦¬ì ì¸ ë‹¨ìœ„ë¡œ ë‚˜ëˆˆ ê²ƒ
  - ì‚¬ìš©ìê°€ ì™¸ë¶€ì—ì„œ ì›¹ì„œë¹„ìŠ¤ë¥¼ ë°©ë¬¸í•  ê²½ìš°, í˜¹ì€ 30ë¶„ê°„ ë™ì‘ì´ ì—†ì„ ë•Œ ìƒˆë¡œìš´ ì„¸ì…˜ ìƒì„±
  - í•˜ë‚˜ì˜ ì‚¬ìš©ìëŠ” í•œ ê°œì˜ ì„¸ì…˜ë§Œì„ ê°€ì§
  - ì„¸ì…˜ì´ ë§Œë“¤ì–´ë‚¸ ì ‘ì (ê²½ìœ ì§€)ë¥¼ ì±„ë„ì˜ ì´ë¦„ìœ¼ë¡œ, ì„¸ì…˜ì´ ìƒê¸´ ì‹œê°„ì„ ê¸°ë¡<br> 
- ìœ„ì˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§ˆì¼€íŒ… ê´€ë ¨, ì‚¬ìš©ì íŠ¸ë˜í”½ ê´€ë ¨ ë°ì´í„° ë¶„ì„ì´ ì´ë£¨ì–´ì§€ê³ ,<br>
  ì–´ëŠ ì±„ë„ì— ê´‘ê³ í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì¸ì§€ ìƒˆë¡œìš´ ë§ˆì¼€íŒ… ì „ëµì´ ìˆ˜ë¦½ë  ìˆ˜ ìˆìŒ

---

### SQL ê¸°ë³¸
- ë‹¤ìˆ˜ì˜ SQLë¬¸ì€ ì„¸ë¯¸ì½œë¡ ìœ¼ë¡œ ë¶„ë¦¬
- SQL ì£¼ì„ì€ ë‹¤ìŒê³¼ ê°™ì´ í‘œê¸°<br>
  `--`: ì¸ë¼ì¸ í•œì¤„ì§œë¦¬ ì£¼ì„<br>
  `/* -- */`: ì—¬ëŸ¬ ì¤„ì— ê±¸ì³ ì‚¬ìš© ê°€ëŠ¥í•œ ì£¼ì„
- ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ì‚¬ëŒì´ ë‹¤ìˆ˜ì¼ ê²½ìš° ëª¨ë“  ì‚¬ëŒë“¤ì´ ê³ ë£¨ ì´í•´í•  ìˆ˜ ìˆëŠ” í‚¤ì›Œë”©ì´ í•„ìš”<br>
  í…Œì´ë¸”, í•„ë“œ ì´ë¦„ì˜ ëª…ëª… ê·œì¹™(ë‹¨ìˆ˜ vs ë³µìˆ˜, _ vs CamelCasing)<br>

### DDL - í…Œì´ë¸” êµ¬ì¡° ì •ì˜
- í…Œì´ë¸” ìƒì„±: `CREATE TABLE`
- ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ì—ì„œëŠ” í›„ë³´í‚¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë‚˜ **ë¬´ì‹œë¨**<br>
  ê·¸ ì´ìœ ëŠ” ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ì— ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€ ì¶”ê°€ë  ë•Œ í•´ë‹¹ í•„ë“œì˜ ìœ ì¼ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´<br>
  í˜„ì¬ ì”ì¡´í•˜ëŠ” ë°ì´í„°ë¥¼ íƒìƒ‰í•´ì•¼ í•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì´ê¸° ë•Œë¬¸<br>
<br>

- í…Œì´ë¸” ì¹¼ëŸ¼(í•„ë“œ)ëª…ìœ¼ë¡œ ì˜ˆì•½ ëª…ë ¹ì–´ í˜¹ì€ ê³µë°±ì´ í¬í•¨ëœ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•  ê²½ìš° `""`ìœ¼ë¡œ ê°ì‹¸ì£¼ê³  ì‚¬ìš©
``` 
CREATE TABLE table(
  "group" int,
  "count people" int, ...
)
```
<br>

- CTAS: `CREATE TABLE table_name AS SELECT`<br>
<br>

- ìœ„ì˜ ì›¹ì„œë¹„ìŠ¤ ì„¸ì…˜ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸” ìƒì„±<br>

```
CREATE TABLE raw_data.user_session_channel(
  userid int,
  sessionid varchar(32) primary key, -- í›„ë³´í‚¤ ì†ì„± ë¬´ì‹œ
  channel varchar(32)
); 
```
<br>

- í…Œì´ë¸” ì‚­ì œ: `DROP TABLE raw_data.user_session_channel;`<br>
  ìœ„ì˜ ê²½ìš°ì—ëŠ” ì—†ëŠ” í…Œì´ë¸”ì„ ì§€ìš°ë ¤ê³  í•˜ëŠ” ê²½ìš° ì—ëŸ¬<br>
  <br>
  
  ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ `IF EXISTS`ë¥¼ ì ìš©<br>
  `DROP TABLE IF EXISTS raw_data.user_session_channel;`<br>
<br>
<br>

- í…Œì´ë¸” ë³€ê²½<br>
  `visitedtime`ì´ë¼ëŠ” ìƒˆë¡œìš´ ì¹¼ëŸ¼ ì¶”ê°€<br>
  `ALTER TABLE raw_data.user_session_channel ADD COLUMN visitedtime;`<br>
  <br>
  
  `visitedtime`ì´ë¼ëŠ” ì¹¼ëŸ¼ì„ `vtime`ìœ¼ë¡œ ë³€ê²½<br>
  `ALTER TABLE raw_data.user_session_channel RENAME visitedtime to vtime; `<br>
  <br>
  
  `vtime`ì¹¼ëŸ¼ ì œê±°<br>
  `ALTER TABLE raw_data.user_session_channel DROP COLUMN vtime`<br>
  <br>
  
  `UserSessionChannel`ë¡œ í…Œì´ë¸” ì´ë¦„ ë³€ê²½<br>
  `ALTER TABLE raw_data.user_session_channel RENAME to raw_data.UserSessionChannel`

---

### DML -  í…Œì´ë¸” ë°ì´í„° ì¡°ì‘
- ë ˆì½”ë“œ ì§ˆì˜: `SELECT`<br>
  - í…Œì´ë¸”ì—ì„œ ë ˆì½”ë“œì™€ í•„ë“œ ì½ê¸°: `SELECT FROM`
  - ì¶”ì¶œí•  ë ˆì½”ë“œì˜ ì¡°ê±´ ì§€ì •: `WHERE`<br>
    - í¬í•¨ì—¬ë¶€ í™•ì¸: `IN`, `NOT IN`<br>
      `WHERE channel IN ('Google', 'Organic')`ëŠ” `WHERE channel = 'Google' OR channel = 'Organic'`ê³¼ ë™ì¼
    - ìœ ì‚¬ ë¬¸ìì—´ í™•ì¸: `LIKE`, `ILIKE` ë§ˆì°¬ê°€ì§€ë¡œ `NOT`ì„ ë¶™ì—¬ì„œ ì‚¬ìš©ê°€ëŠ¥<br>
      - ì±„ë„ ì¤‘ì— 'G'ë¡œ ì‹œì‘í•˜ëŠ” ì¡°ê±´: `WHERE channel LIKE 'G%'
      - ì±„ë„ ì¤‘ì— 'o'ê°€ ë“¤ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì¡°ê±´: `WHERE channel LIKE '%o%'
      - `LIKE`: ëŒ€ì†Œë¬¸ì íŒë³„ 
      - `ILIKE`: ëŒ€ì†Œë¬¸ì íŒë³„í•˜ì§€ ì•ŠìŒ<br>
    - íƒ€ì„ ìŠ¤íƒ¬í”„ ë°ì´í„°ì—ì„œ ë‚ ì§œì™€ ë‚ ì§œ ì‚¬ì´ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„° ì¶”ì¶œ: `BETWEEN`<br>
    <br>
  - ë ˆì½”ë“œë¥¼ íŠ¹ì • í•„ë“œë¥¼ ë¬¶ì–´ì„œ ì¶”ì¶œ: `GROUP BY`
  - ë ˆì½”ë“œ ìˆœì„œë¥¼ ì§€ì •: `ORDER BY`<br>
    - ì˜¤ë¦„ì°¨ìˆœ: `ORDER BY channel ASC`
    - ë‚´ë¦¼ì°¨ìˆœ: `ORDER BY channel DESC`
    - ë””í´íŠ¸ ê°’ì€ ASCë¡œ `ORDER BY channel DESC, userid`ì—ì„œëŠ”<br>
      1ìˆœìœ„ëŠ” channelì— ëŒ€í•´ ë‚´ë¦¼ì°¨ìˆœ, 2ìˆœìœ„ëŠ” useridì— ëŒ€í•´ ì˜¤ë¦„ì°¨ìˆœ
    - NULLê°’ì˜ ì²˜ë¦¬ëŠ” ì˜¤ë¦„ì°¨ìˆœì˜ ê²½ìš° ë§ˆì§€ë§‰ì—, ë‚´ë¦¼ì°¨ìˆœì˜ ê²½ìš° ì²˜ìŒì— ìœ„ì¹˜<br>
      ê·¸ëŸ¬ë‚˜ `NULLS FIRST` í˜¹ì€ `NULLS LAST`ë¡œ ì •ë ¬ ì œì–´ê°€ëŠ¥<br>
<br>

- ë ˆì½”ë“œ ìˆ˜ì •<br>
  - í…Œì´ë¸”ì— ë ˆì½”ë“œë¥¼ ì¶”ê°€: `INSERT INTO`
  - í…Œì´ë¸” ë ˆì½”ë“œì˜ í•„ë“œ ê°’ ìˆ˜ì •: `UPDATE FROM`
  - í…Œì´ë¸”ì—ì„œ ë ˆì½”ë“œ ì‚­ì œ: `DELETE FROM`<br>
<br>

- í•„ë“œ ê°’ì˜ ë³€í™˜: `CASE WHEN`
```
CASE 
    WHEN channel in ('Facebook', 'Instagram') THEN 'Social-Media'
    WHEN channel in ('Google', 'Naver') THEN 'Search-Engine'
    ELSE 'Something-Else'
END channel_type
```

---

### NULL
- ê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒì„ ë‚˜íƒ€ë‚´ëŠ” ìƒìˆ˜ë¡œ ê²°ì¸¡ì¹˜ì— í•´ë‹¹ **(0, ''ì´ ì•„ë‹˜)**
- ì–´ë–¤ í•„ë“œì˜ ê°’ì´ NULLì¸ì§€ í™•ì¸(ë¹„êµë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥): `channel is NULL` í˜¹ì€ `channel is not NULL`
- NULLì´ ì‚¬ì¹™ì—°ì‚°ì— ì‚¬ìš©ë˜ë©´ ê·¸ ê°’ì€ NULL

### Type Casting
- `::` ì˜¤í¼ë ˆì´í„° ì‚¬ìš©: `userid::float`
- `cast` í•¨ìˆ˜ ì‚¬ìš©: `cast(userid as float)`

---

### SQL ì‹¤ìŠµ

`%%sql`ì„ ê°€ì¥ ìœ„ì— ë¶™ì—¬ì¤˜ì•¼ SQLì´ ì‘ë™<br>
`raw_data`ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì•ˆì— `user_session_channel`ì˜ ì´ë¦„ì„ ê°€ì§€ëŠ” í…Œì´ë¸”ì— ì ‘ê·¼

### ì‹¤ìŠµí™˜ê²½
- AWS Redshift í´ëŸ¬ìŠ¤í„°
- AWS ì„œë¹„ìŠ¤ > ë¶„ì„ > Amazon Redshift
- dc2.large instance ìƒì„±: 160GB
- í˜¸ìŠ¤íŠ¸: learnde
- í¬íŠ¸ ë²ˆí˜¸: 5439
- ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„: dev

---

### SQL ì‚¬ìš© ì „ ëª¨ë“ˆ ì„¤ì¹˜ ë° ë¡œë“œ


```python
!pip install ipython-sql
```

    Collecting ipython-sql
      Downloading ipython_sql-0.4.0-py3-none-any.whl (19 kB)
    Collecting prettytable<1
      Downloading prettytable-0.7.2.zip (28 kB)
      Preparing metadata (setup.py) ... [?25ldone
    [?25hCollecting sqlparse
      Using cached sqlparse-0.4.2-py3-none-any.whl (42 kB)
    Requirement already satisfied: sqlalchemy>=0.6.7 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython-sql) (1.4.22)
    Requirement already satisfied: six in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython-sql) (1.16.0)
    Requirement already satisfied: ipython-genutils>=0.1.0 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython-sql) (0.2.0)
    Requirement already satisfied: ipython>=1.0 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython-sql) (7.29.0)
    Requirement already satisfied: pexpect>4.3 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (4.8.0)
    Requirement already satisfied: setuptools>=18.5 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (60.5.0)
    Requirement already satisfied: traitlets>=4.2 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (5.1.0)
    Requirement already satisfied: appnope in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (0.1.2)
    Requirement already satisfied: matplotlib-inline in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (0.1.2)
    Requirement already satisfied: decorator in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (5.1.0)
    Requirement already satisfied: jedi>=0.16 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (0.18.0)
    Requirement already satisfied: pygments in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (2.10.0)
    Requirement already satisfied: pickleshare in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (0.7.5)
    Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,<3.1.0,>=2.0.0 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (3.0.20)
    Requirement already satisfied: backcall in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from ipython>=1.0->ipython-sql) (0.2.0)
    Requirement already satisfied: greenlet!=0.4.17 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from sqlalchemy>=0.6.7->ipython-sql) (1.1.1)
    Requirement already satisfied: parso<0.9.0,>=0.8.0 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from jedi>=0.16->ipython>=1.0->ipython-sql) (0.8.2)
    Requirement already satisfied: ptyprocess>=0.5 in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from pexpect>4.3->ipython>=1.0->ipython-sql) (0.7.0)
    Requirement already satisfied: wcwidth in /Users/llong/opt/anaconda3/lib/python3.9/site-packages (from prompt-toolkit!=3.0.0,!=3.0.1,<3.1.0,>=2.0.0->ipython>=1.0->ipython-sql) (0.2.5)
    Building wheels for collected packages: prettytable
      Building wheel for prettytable (setup.py) ... [?25ldone
    [?25h  Created wheel for prettytable: filename=prettytable-0.7.2-py3-none-any.whl size=13714 sha256=17ca6d7fe8750dbb9cce5bc6c43970b2a918eede8b4acc9656ad6a53bff87529
      Stored in directory: /Users/llong/Library/Caches/pip/wheels/75/f7/28/77a076f1fa8cbeda61aca712815d04d7a32435f04a26a2dd7b
    Successfully built prettytable
    Installing collected packages: prettytable, sqlparse, ipython-sql
      Attempting uninstall: prettytable
        Found existing installation: prettytable 3.0.0
        Uninstalling prettytable-3.0.0:
          Successfully uninstalled prettytable-3.0.0
    Successfully installed ipython-sql-0.4.0 prettytable-0.7.2 sqlparse-0.4.2



```python
!pip install psycopg2-binary
```

    Collecting psycopg2-binary
      Downloading psycopg2_binary-2.9.3-cp39-cp39-macosx_10_14_x86_64.macosx_10_9_intel.macosx_10_9_x86_64.macosx_10_10_intel.macosx_10_10_x86_64.whl (2.2 MB)
    [2K     [90mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [32m2.2/2.2 MB[0m [31m20.5 MB/s[0m eta [36m0:00:00[0ma [36m0:00:01[0m
    [?25hInstalling collected packages: psycopg2-binary
    Successfully installed psycopg2-binary-2.9.3



```python
%load_ext sql
```

### redshiftì— ì ‘ê·¼


```python
%sql postgresql://...
```

#### ê°€ì¥ ìœ„ì— ìˆëŠ” 10ê°œ ë°ì´í„° ì¶”ì¶œ


```sql
%%sql

SELECT * FROM raw_data.user_session_channel LIMIT 10; -- ê°€ì¥ ìœ„ì— ìˆëŠ” 10ê°œ ë°ì´í„° ì¶”ì¶œ 
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    10 rows affected.





<table>
    <tr>
        <th>userid</th>
        <th>sessionid</th>
        <th>channel</th>
    </tr>
    <tr>
        <td>1651</td>
        <td>0004289ee1c7b8b08c77e19878106ae3</td>
        <td>Organic</td>
    </tr>
    <tr>
        <td>1197</td>
        <td>00053f5e11d1fe4e49a221165b39abc9</td>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>1401</td>
        <td>00056c20eb5a029583db75506953f1d9</td>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>1399</td>
        <td>00063cb5da1826febf178b669eea3250</td>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>1667</td>
        <td>000958fdaefe0dd06f5d7c4e4a5f28d1</td>
        <td>Instagram</td>
    </tr>
    <tr>
        <td>468</td>
        <td>000a3f777828d2cdbee98887561aa130</td>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>1563</td>
        <td>000cb7efa8a05429dd5309b4bea2eb0c</td>
        <td>Naver</td>
    </tr>
    <tr>
        <td>711</td>
        <td>00106ac9184e7d54b570d0f0cb0c38b2</td>
        <td>Organic</td>
    </tr>
    <tr>
        <td>473</td>
        <td>0011df6282fe8cf78feeab676fbc3c27</td>
        <td>Naver</td>
    </tr>
    <tr>
        <td>420</td>
        <td>00126b47d5502dfb7d01f750ad23d813</td>
        <td>Facebook</td>
    </tr>
</table>



#### ì ‘ê·¼í•œ Redshiftì—ì„œ useridê°€ 1005ì¸ ë°ì´í„° ì¶”ì¶œ


```sql
%%sql

/* usweridê°€ 1005ì¸ ë°ì´í„°ë¥¼
   raw_data ë°ì´í„°ë² ì´ìŠ¤ì˜ user_session_channel í…Œì´ë¸”ì—ì„œ ì¶”ì¶œ */

SELECT * FROM raw_data.user_session_channel WHERE userid = 1005; 
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    11 rows affected.





<table>
    <tr>
        <th>userid</th>
        <th>sessionid</th>
        <th>channel</th>
    </tr>
    <tr>
        <td>1005</td>
        <td>4c92d46d3b1aad8a64eb35d7312d067c</td>
        <td>Google</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>5aa3405a3f865c10f420a4a7b55cbff3</td>
        <td>Organic</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>cdf6581cb7aca4b7e19ef136c6e601a5</td>
        <td>Youtube</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>432fd02f951f393df1591310e6811118</td>
        <td>Organic</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>4cce0644e37052e4c750f194dd5cccfd</td>
        <td>Organic</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>4e506257166306736b63d7e6c9f6d693</td>
        <td>Youtube</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>6ba5bc4fe4c3f704112d0ba94020f4c2</td>
        <td>Naver</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>c5a3c867a3dfb776552dcfc804d4937e</td>
        <td>Instagram</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>d2e3e0c2ec10101c41b7f0a11ce93c57</td>
        <td>Naver</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>e32c6c0d76c602ec48a1ec030982eb85</td>
        <td>Naver</td>
    </tr>
    <tr>
        <td>1005</td>
        <td>e96b07acb4f9f90f7038004ece14038f</td>
        <td>Google</td>
    </tr>
</table>



#### ìœ ì¼í•œ ì±„ë„ ì´ë¦„


```sql
%%sql

SELECT DISTINCT channel FROM raw_data.user_session_channel;
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    6 rows affected.





<table>
    <tr>
        <th>channel</th>
    </tr>
    <tr>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>Instagram</td>
    </tr>
    <tr>
        <td>Naver</td>
    </tr>
    <tr>
        <td>Youtube</td>
    </tr>
    <tr>
        <td>Organic</td>
    </tr>
    <tr>
        <td>Google</td>
    </tr>
</table>



#### COUNT í•¨ìˆ˜ì˜ ì´í•´
- COUNTí•¨ìˆ˜ ë‚´ë¶€ ì¸ìê°€ Trueì¸ì§€ Falseì¸ì§€**(NOT NULL vs NULL)**


```sql
%%sql

SELECT COUNT(1)
FROM raw_data.user_session_channel

/* SELECT COUNT(0)
FROM raw_data.user_session_channel ë˜í•œ ë™ì¼í•œ ê²°ê³¼*/

/* COUNT()í•¨ìˆ˜ ë‚´ë¶€ì¸ìê°’ì´ NULLì´ ì•„ë‹Œ ê²½ìš° TRUEê°’ì´ë¼ê³  ìƒê°í•˜ë©´ ë¨
   ë”°ë¼ì„œ ë ˆì½”ë“œë¥¼ í•˜ë‚˜ì”© íƒìƒ‰í•  ë•Œë§ˆë‹¤ 1ê°œì”© ì¹´ìš´íŠ¸ */
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    1 rows affected.





<table>
    <tr>
        <th>count</th>
    </tr>
    <tr>
        <td>101520</td>
    </tr>
</table>




```sql
%%sql

SELECT COUNT(NULL)
FROM raw_data.user_session_channel

/* ë°˜ë©´ COUNT()í•¨ìˆ˜ ë‚´ë¶€ì¸ìê°’ì´ NULLì¸ ê²½ìš° Falseê°’ì´ë¼ê³  ìƒê°í•˜ë©´ ë¨
   ë”°ë¼ì„œ ë ˆì½”ë“œë¥¼ íƒìƒ‰í•´ë„ ì¹´ìš´íŠ¸ë˜ì§€ ì•ŠìŒ */
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    1 rows affected.





<table>
    <tr>
        <th>count</th>
    </tr>
    <tr>
        <td>0</td>
    </tr>
</table>




```sql
%%sql

SELECT COUNT(DISTINCT channel) 
FROM raw_data.user_session_channel

/* DISTICT ëª…ë ¹ ì‹¤í–‰ ì‹œ 6ê°œì˜ ë ˆì½”ë“œ(+ 1(ê°’ì´ NULLì¸ ë ˆì½”ë“œ), ì´ ê²½ìš°ì— í•´ë‹¹ë˜ì§€ ì•ŠìŒ)ë§Œ ë‚¨ê²Œë¨ */
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    1 rows affected.





<table>
    <tr>
        <th>count</th>
    </tr>
    <tr>
        <td>6</td>
    </tr>
</table>



#### ì±„ë„ë³„ ì¹´ìš´íŠ¸


```sql
%%sql

SELECT channel, COUNT(1)
FROM raw_data.user_session_channel 
GROUP BY 1; -- ì‚¬ìš©ìë§ˆë‹¤ í‘œê¸°í•˜ëŠ” ë°©ì‹ì´ ë‹¤ë¦„(í•„ë“œ ì´ë¦„ ì‚¬ìš© vs ìˆœë²ˆ ë§¤ê¸°ê¸°)
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    6 rows affected.





<table>
    <tr>
        <th>channel</th>
        <th>count</th>
    </tr>
    <tr>
        <td>Naver</td>
        <td>16921</td>
    </tr>
    <tr>
        <td>Youtube</td>
        <td>17091</td>
    </tr>
    <tr>
        <td>Instagram</td>
        <td>16831</td>
    </tr>
    <tr>
        <td>Facebook</td>
        <td>16791</td>
    </tr>
    <tr>
        <td>Organic</td>
        <td>16904</td>
    </tr>
    <tr>
        <td>Google</td>
        <td>16982</td>
    </tr>
</table>



#### channel ì´ë¦„ì´ Facebookì¸ ê²½ìš°ë§Œ ê³ ë ¤í•´ì„œ ë ˆì½”ë“œ ìˆ˜ ì¹´ìš´íŠ¸


```sql
%%sql

SELECT COUNT(*)
FROM raw_data.user_session_channel
WHERE channel = 'Facebook';
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    1 rows affected.





<table>
    <tr>
        <th>count</th>
    </tr>
    <tr>
        <td>16791</td>
    </tr>
</table>



#### CASE WHEN ì˜ˆì‹œ


```sql
%%sql

SELECT *, CASE
    WHEN channel in ('Facebook', 'Instagram') THEN 'Social-Media'
    WHEN channel in ('Google', 'Naver') THEN 'Search-engine'
    ELSE 'Something-Else'
END channel_type
FROM raw_data.user_session_channel
LIMIT 10;
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    10 rows affected.





<table>
    <tr>
        <th>userid</th>
        <th>sessionid</th>
        <th>channel</th>
        <th>channel_type</th>
    </tr>
    <tr>
        <td>1491</td>
        <td>00029153d12ae1c9abe59c17ff2e0895</td>
        <td>Organic</td>
        <td>Something-Else</td>
    </tr>
    <tr>
        <td>59</td>
        <td>0002ac0d783338cfeab0b2bdbd872cda</td>
        <td>Naver</td>
        <td>Search-engine</td>
    </tr>
    <tr>
        <td>117</td>
        <td>0006246bee639c7a7b11a08e34dd3cc6</td>
        <td>Youtube</td>
        <td>Something-Else</td>
    </tr>
    <tr>
        <td>572</td>
        <td>0006dd05ea1e999ddaa041a7091b7b36</td>
        <td>Organic</td>
        <td>Something-Else</td>
    </tr>
    <tr>
        <td>935</td>
        <td>0007cda84fafdcf42f96c4f4adb7f8ce</td>
        <td>Google</td>
        <td>Search-engine</td>
    </tr>
    <tr>
        <td>1363</td>
        <td>000a91f3e374e6147d58ed1814247508</td>
        <td>Naver</td>
        <td>Search-engine</td>
    </tr>
    <tr>
        <td>780</td>
        <td>000c076c390a4c357313fca29e390ece</td>
        <td>Naver</td>
        <td>Search-engine</td>
    </tr>
    <tr>
        <td>1917</td>
        <td>000d0c74074191add6f22e0004db8f76</td>
        <td>Organic</td>
        <td>Something-Else</td>
    </tr>
    <tr>
        <td>1357</td>
        <td>000d54aadcedee0739d39127955f2cdb</td>
        <td>Instagram</td>
        <td>Social-Media</td>
    </tr>
    <tr>
        <td>1247</td>
        <td>000dd3543ac84d906eae52e7c779bb2a</td>
        <td>Naver</td>
        <td>Search-engine</td>
    </tr>
</table>



####  'o'ë¼ëŠ” ë¬¸ìì—´ì´ í¬í•¨ëœ ì±„ë„(ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•ŠìŒ)


```sql
%%sql

SELECT DISTINCT channel
FROM raw_data.user_session_channel
WHERE channel ILIKE '%o%';
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    4 rows affected.





<table>
    <tr>
        <th>channel</th>
    </tr>
    <tr>
        <td>Facebook</td>
    </tr>
    <tr>
        <td>Youtube</td>
    </tr>
    <tr>
        <td>Organic</td>
    </tr>
    <tr>
        <td>Google</td>
    </tr>
</table>



#### ì—¬ëŸ¬ê°€ì§€ ë¬¸ìì—´ ë‚´ì¥í•¨ìˆ˜


```sql
%%sql

SELECT LEN(channel), UPPER(channel), LOWER(channel), LEFT(channel, 3)
From raw_data.user_session_channel
LIMIT 10;
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    10 rows affected.





<table>
    <tr>
        <th>len</th>
        <th>upper</th>
        <th>lower</th>
        <th>left</th>
    </tr>
    <tr>
        <td>7</td>
        <td>ORGANIC</td>
        <td>organic</td>
        <td>Org</td>
    </tr>
    <tr>
        <td>5</td>
        <td>NAVER</td>
        <td>naver</td>
        <td>Nav</td>
    </tr>
    <tr>
        <td>7</td>
        <td>YOUTUBE</td>
        <td>youtube</td>
        <td>You</td>
    </tr>
    <tr>
        <td>7</td>
        <td>ORGANIC</td>
        <td>organic</td>
        <td>Org</td>
    </tr>
    <tr>
        <td>6</td>
        <td>GOOGLE</td>
        <td>google</td>
        <td>Goo</td>
    </tr>
    <tr>
        <td>5</td>
        <td>NAVER</td>
        <td>naver</td>
        <td>Nav</td>
    </tr>
    <tr>
        <td>5</td>
        <td>NAVER</td>
        <td>naver</td>
        <td>Nav</td>
    </tr>
    <tr>
        <td>7</td>
        <td>ORGANIC</td>
        <td>organic</td>
        <td>Org</td>
    </tr>
    <tr>
        <td>9</td>
        <td>INSTAGRAM</td>
        <td>instagram</td>
        <td>Ins</td>
    </tr>
    <tr>
        <td>5</td>
        <td>NAVER</td>
        <td>naver</td>
        <td>Nav</td>
    </tr>
</table>



#### ì‹œê°„ ì •ë³´ ì¶œë ¥ ë° ì‹œê°„ëŒ€ ë³€í™˜


```sql
%%sql

SELECT GETDATE(), CONVERT_TIMEZONE('AMERICA/Los_angeles', GETDATE());
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    1 rows affected.





<table>
    <tr>
        <th>getdate</th>
        <th>convert_timezone</th>
    </tr>
    <tr>
        <td>2022-02-22 18:11:53</td>
        <td>2022-02-22 10:11:53</td>
    </tr>
</table>



#### íŒë‹¤ìŠ¤ì™€ ì—°ë™


```python
import pandas as pd
```


```python
res = %sql SELECT * FROM raw_data.user_session_channel
print('ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë² ì´ìŠ¤ì˜ íƒ€ì…:', type(res))
df = res.DataFrame()
```

     * postgresql://guest:***@learnde.cduaw970ssvt.ap-northeast-2.redshift.amazonaws.com:5439/dev
    101520 rows affected.
    ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë² ì´ìŠ¤ì˜ íƒ€ì…: <class 'sql.run.ResultSet'>



```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userid</th>
      <th>sessionid</th>
      <th>channel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1651</td>
      <td>0004289ee1c7b8b08c77e19878106ae3</td>
      <td>Organic</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1197</td>
      <td>00053f5e11d1fe4e49a221165b39abc9</td>
      <td>Facebook</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1401</td>
      <td>00056c20eb5a029583db75506953f1d9</td>
      <td>Facebook</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1399</td>
      <td>00063cb5da1826febf178b669eea3250</td>
      <td>Facebook</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1667</td>
      <td>000958fdaefe0dd06f5d7c4e4a5f28d1</td>
      <td>Instagram</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby(['channel']).size()
```




    channel
    Facebook     16791
    Google       16982
    Instagram    16831
    Naver        16921
    Organic      16904
    Youtube      17091
    dtype: int64



### ëŠë‚€ì 
ì–´ì œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ëŒ€ë¶€ë¶„ ì•Œê³ ìˆë˜ ë‚´ìš©ì´ë¼ í•™ìŠµì— í° ì§€ì¥ì€ ì—†ì—ˆë‹¤.<br>
í•˜ì§€ë§Œ ì‹¤ìŠµê°„ ëŠ¥ìˆ™í•˜ê²Œ ì•Œì§€ ëª»í–ˆë˜ ë¶€ë¶„ì´ ìˆì—ˆê³ , ê°œë…ì„ ë°”ë¡œì¡ì„ ìˆ˜ ìˆì—ˆë‹¤.<br>
ë˜í•œ ì²˜ìŒ ë³¸ êµ¬ë¬¸ë„ ìˆì–´ì„œ ì‹¤ìŠµí•˜ë©´ì„œ ì˜ ìµí ìˆ˜ ìˆì—ˆë‹¤.<br>
